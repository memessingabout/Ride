<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rider Registration | Blue & Gold</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #1a237e;
            --light-blue: #534bae;
            --dark-blue: #000051;
            --primary-gold: #ffd700;
            --light-gold: #ffff52;
            --dark-gold: #c7a600;
            
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0, 0.2), 0 4px 6px -4px rgba(0,0,0, 0.15);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

            --success-text: #99ff99;
            --error-text: #ff9999;
            --info-text: #99ccff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 0;
        }

        .container { width: 100%; max-width: 48rem; margin: auto; padding: 1rem; }
        .card { background-color: rgba(255, 255, 255, 0.08); backdrop-filter: blur(8px); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); padding: 2rem; border: 1px solid var(--primary-gold); }
        .header { text-align: center; margin-bottom: 2rem; }
        .logo { display: flex; align-items: center; justify-content: center; gap: 0.75rem; margin-bottom: 1rem; color: var(--primary-gold); }
        .logo-icon { width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; background-color: rgba(255, 215, 0, 0.1); border-radius: var(--radius-md); color: var(--primary-gold); font-size: 1.25rem; font-weight: 700; }
        .logo-text { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.025em; color: var(--primary-gold); }
        h1 { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--primary-gold); }
        .subtitle { color: rgba(255, 255, 255, 0.8); font-size: 0.875rem; }

        .progress-bar { display: flex; justify-content: space-between; position: relative; margin-bottom: 2rem; }
        .progress-bar::before { content: ""; position: absolute; top: 50%; left: 0; right: 0; height: 2px; background-color: rgba(255, 215, 0, 0.3); z-index: 1; transform: translateY(-50%); }
        .progress-step { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; width: 33.33%; /* 3 steps */ }
        .step-number { width: 2rem; height: 2rem; border-radius: 50%; background-color: rgba(255, 255, 255, 0.2); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-bottom: 0.5rem; transition: var(--transition); border: 1px solid rgba(255, 215, 0, 0.3); }
        .step-label { font-size: 0.75rem; font-weight: 500; color: rgba(255, 255, 255, 0.7); text-align: center; }
        .progress-step.active .step-number { background-color: var(--primary-gold); color: var(--primary-blue); border-color: var(--primary-gold); }
        .progress-step.completed .step-number { background-color: var(--light-gold); color: var(--dark-blue); border-color: var(--light-gold); }
        .progress-step.completed .step-number::after { content: '✔'; font-size: 0.8rem; position: absolute; }

        .form-step { display: none; }
        .form-step.active { display: block; }
        .form-group { margin-bottom: 1.25rem; }
        .form-row { display: flex; gap: 1rem; margin-bottom: 1.25rem; }
        .form-row .form-group { flex: 1; margin-bottom: 0; }
        .form-label { display: block; margin-bottom: 0.5rem; font-size: 0.875rem; font-weight: 500; color: var(--primary-gold); }
        .form-label.required::after { content: " *"; color: var(--light-gold); }

        .form-control, .otp-input, textarea.form-control { width: 100%; padding: 0.75rem 1rem; border-radius: var(--radius-md); border: 1px solid rgba(255, 215, 0, 0.4); background-color: rgba(255, 255, 255, 0.1); color: white; font-size: 0.875rem; transition: var(--transition); }
        .form-control:focus, .otp-input:focus, textarea.form-control:focus { outline: none; border-color: var(--primary-gold); background-color: rgba(255, 255, 255, 0.15); box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2); }
        .form-control::placeholder, textarea.form-control::placeholder { color: rgba(255, 255, 255, 0.6); }
        
        .password-input-container { position: relative; display: flex; align-items: center; }
        .password-input-container .form-control { padding-right: 2.5rem; /* Space for toggle icon */ }
        .password-toggle-icon { position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--primary-gold); font-style: normal; user-select: none; }
        .password-requirements { font-size: 0.75rem; color: rgba(255,255,255,0.7); margin-top: 0.35rem; padding-left: 0.1rem;}


        .file-upload { display: flex; flex-direction: column; align-items: center; padding: 1.5rem; border: 2px dashed rgba(255, 215, 0, 0.5); border-radius: var(--radius-md); background-color: rgba(255, 255, 255, 0.05); cursor: pointer; transition: var(--transition); text-align: center; }
        .file-upload:hover { border-color: var(--primary-gold); }
        .file-upload-icon { font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--primary-gold); }
        .file-upload-text { font-size: 0.875rem; color: rgba(255, 255, 255, 0.8); }
        .file-upload-text strong { color: var(--primary-gold); font-weight: 600; }
        .file-upload-input { display: none; }
        .file-preview { margin-top: 0.75rem; font-size: 0.8rem; color: rgba(255, 255, 255, 0.9); text-align: left; }
        .file-preview div { color: var(--light-gold); }

        .btn { padding: 0.75rem 1.5rem; border-radius: var(--radius-md); font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .btn-primary { background-color: var(--primary-gold); color: var(--primary-blue); border: none; }
        .btn-primary:hover { background-color: var(--light-gold); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(255, 215, 0, 0.3); }
        .btn-secondary { background-color: transparent; border: 1px solid var(--primary-gold); color: var(--primary-gold); }
        .btn-secondary:hover { background-color: rgba(255, 215, 0, 0.1); transform: translateY(-2px); box-shadow: 0 2px 8px rgba(255, 215, 0, 0.2); }
        .btn-group { display: flex; justify-content: space-between; margin-top: 2rem; gap: 1rem; }
        .btn-group .btn { flex-grow: 1; } .btn-group .btn-primary { flex-grow: 2; }

        .otp-container { display: flex; justify-content: space-between; margin-bottom: 1.5rem; gap: 0.5rem; }
        .otp-input { flex: 1; aspect-ratio: 1; text-align: center; font-size: 1.25rem; padding: 0.5rem; line-height: 1; }

        .alert { padding: 0.875rem 1.25rem; border-radius: var(--radius-md); margin-bottom: 1.25rem; font-size: 0.875rem; display: flex; align-items: flex-start; gap: 0.75rem; }
        .alert-icon { flex-shrink: 0; font-size: 1.125rem; margin-top: 0.125rem; }
        .alert-error { background-color: rgba(229, 57, 53, 0.15); border: 1px solid rgba(229, 57, 53, 0.3); color: var(--error-text); }
        .alert-error .alert-icon { color: var(--error-text); }
        .alert-success { background-color: rgba(76, 175, 80, 0.15); border: 1px solid rgba(76, 175, 80, 0.3); color: var(--success-text); }
        .alert-success .alert-icon { color: var(--success-text); }
        .alert-info { background-color: rgba(0, 150, 255, 0.15); border: 1px solid rgba(0, 150, 255, 0.3); color: var(--info-text); }
        .alert-info .alert-icon { color: var(--info-text); }

        .section-title { font-size: 1.125rem; font-weight: 600; margin: 2rem 0 1.25rem; padding-bottom: 0.75rem; border-bottom: 1px solid rgba(255, 215, 0, 0.4); color: var(--primary-gold); }
        
        .btn-loading { position: relative; pointer-events: none; opacity: 0.8; }
        .btn-loading::after { content: ""; position: absolute; top: 50%; left: 50%; width: 1rem; height: 1rem; margin-top: -0.5rem; margin-left: -0.5rem; border: 2px solid var(--primary-blue); border-radius: 50%; border-top-color: transparent; border-right-color: transparent; animation: spin 0.8s linear infinite; }
        .btn-secondary.btn-loading::after { border: 2px solid var(--primary-gold); border-top-color: transparent; border-right-color: transparent; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .hidden-section { display: none !important; } /* Utility to hide sections */

        @media (max-width: 768px) {
            .card { padding: 1.5rem; }
            .form-row { flex-direction: column; gap: 0; margin-bottom: 0; }
            .form-row .form-group { margin-bottom: 1.25rem; }
            .step-label { display: none; }
            .progress-step { width: auto; padding: 0 0.5rem; }
            .btn-group { flex-direction: column; gap: 0.75rem; }
            .btn-group .btn { width: 100%; }
            h1 { font-size: 1.25rem; } .section-title { font-size: 1rem; }
            .otp-container { gap: 0.25rem; } .otp-input { font-size: 1rem; padding: 0.4rem; }
        }
        @media (max-width: 480px) {
            .card { padding: 1rem; } h1 { font-size: 1.1rem; }
            .logo-text { font-size: 1.25rem; } .logo-icon { width: 2rem; height: 2rem; font-size: 1rem; }
            .btn { font-size: 0.8rem; padding: 0.6rem 1rem; }
            .form-control, textarea.form-control, .otp-input { font-size: 0.8rem; padding: 0.6rem 0.8rem; }
            .file-upload { padding: 1rem; } .file-upload-icon { font-size: 1.25rem; } .file-upload-text { font-size: 0.75rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <div class="logo">
                    <div class="logo-icon">🏍️</div>
                    <span class="logo-text">RiderConnect</span>
                </div>
                <h1>Create Your Rider Account</h1>
                <p class="subtitle">Complete your registration in 3 simple steps</p>
            </div>

            <div id="global-alert-placeholder" style="margin-bottom: 1.5rem;"></div>

            <div class="progress-bar">
                <div class="progress-step active" id="step1-indicator">
                    <div class="step-number">1</div>
                    <div class="step-label">Contact & Secure</div>
                </div>
                <div class="progress-step" id="step2-indicator">
                    <div class="step-number">2</div>
                    <div class="step-label">Documents</div>
                </div>
                <div class="progress-step" id="step3-indicator">
                    <div class="step-number">3</div>
                    <div class="step-label">Profile</div>
                </div>
            </div>

            <form id="step1-contact-secure-form" class="form-step active">
                <div id="contact-input-section">
                    <div class="alert alert-info"><span class="alert-icon">ℹ️</span><span>Enter your email and phone to begin.</span></div>
                    <div class="form-group">
                        <label for="email" class="form-label required">Email Address</label>
                        <input type="email" id="email" class="form-control" placeholder="your.email@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="phone" class="form-label required">Phone Number</label>
                        <input type="tel" id="phone" class="form-control" placeholder="e.g., 0712345678" required>
                    </div>
                </div>

                <div id="otp-verification-section" class="hidden-section">
                    <h3 class="section-title" style="margin-top:1rem;">Verify Contact Details</h3>
                    <div class="form-group" id="email-otp-group">
                        <label class="form-label required">Email Verification Code</label>
                        <div class="otp-container">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="email" data-index="0" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="email" data-index="1" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="email" data-index="2" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="email" data-index="3" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="email" data-index="4" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="email" data-index="5" inputmode="numeric" pattern="[0-9]*">
                        </div>
                        <div class="alert alert-info" style="margin-top: 1rem; font-size: 0.8rem;">
                            <span class="alert-icon">ℹ️</span>
                            <span>Code sent to your email. <button type="button" class="btn btn-secondary btn-sm" id="resend-email-otp" style="padding: 0.2rem 0.5rem; font-size: 0.7rem; vertical-align: middle;">Resend</button></span>
                        </div>
                    </div>
                    <div class="form-group" id="phone-otp-group">
                        <label class="form-label required">SMS Verification Code</label>
                        <div class="otp-container">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="phone" data-index="0" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="phone" data-index="1" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="phone" data-index="2" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="phone" data-index="3" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="phone" data-index="4" inputmode="numeric" pattern="[0-9]*">
                            <input type="text" class="otp-input" maxlength="1" data-otp-group="phone" data-index="5" inputmode="numeric" pattern="[0-9]*">
                        </div>
                         <div class="alert alert-info" style="margin-top: 1rem; font-size: 0.8rem;">
                            <span class="alert-icon">ℹ️</span>
                            <span>Code sent to your phone. <button type="button" class="btn btn-secondary btn-sm" id="resend-phone-otp" style="padding: 0.2rem 0.5rem; font-size: 0.7rem; vertical-align: middle;">Resend</button></span>
                        </div>
                    </div>
                </div>

                <div id="password-setup-section" class="hidden-section">
                    <h3 class="section-title" style="margin-top: 1rem;">Set Your Password</h3>
                    <div class="form-group">
                        <label for="password" class="form-label required">Password</label>
                        <div class="password-input-container">
                            <input type="password" id="password" class="form-control" placeholder="Create a strong password" required>
                            <span class="password-toggle-icon" data-target="password">👁️</span>
                        </div>
                        <div class="password-requirements">Min. 8 characters, uppercase, lowercase, number, & symbol.</div>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password" class="form-label required">Confirm Password</label>
                         <div class="password-input-container">
                            <input type="password" id="confirm-password" class="form-control" placeholder="Confirm your password" required>
                            <span class="password-toggle-icon" data-target="confirm-password">👁️</span>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                     <button type="button" class="btn btn-primary" id="step1-master-next" style="margin-left: auto;">Continue</button>
                </div>
            </form>

            <form id="step2-documents-form" class="form-step">
                 <h3 class="section-title">Personal Information</h3>
                <div class="form-group"> <label for="full-name" class="form-label required">Full Name (as on ID)</label> <input type="text" id="full-name" class="form-control" placeholder="e.g., John Doe" required> </div>
                <div class="form-row"> <div class="form-group"> <label for="id-number" class="form-label required">National ID Number</label> <input type="text" id="id-number" class="form-control" placeholder="Enter ID number" required> </div> <div class="form-group"> <label for="id-expiry" class="form-label required">ID Expiry Date</label> <input type="date" id="id-expiry" class="form-control" required> </div> </div>
                <div class="form-group"> <label class="form-label required">National ID Front Image</label> <label class="file-upload" for="id-front"> <span class="file-upload-icon">📷</span> <span class="file-upload-text"><strong>Click to upload</strong> or drag & drop (JPG, PNG, max 5MB)</span> <input type="file" id="id-front" class="file-upload-input" accept="image/jpeg,image/png" required> </label> <div class="file-preview" id="id-front-preview"></div> </div>
                <h3 class="section-title">Driver's License</h3>
                <div class="form-row"> <div class="form-group"> <label for="dl-number" class="form-label required">License Number</label> <input type="text" id="dl-number" class="form-control" placeholder="Enter license number" required> </div> <div class="form-group"> <label for="dl-expiry" class="form-label required">License Expiry Date</label> <input type="date" id="dl-expiry" class="form-control" required> </div> </div>
                <div class="form-group"> <label class="form-label required">Driver's License Image</label> <label class="file-upload" for="dl-image"><span class="file-upload-icon">💳</span> <span class="file-upload-text"><strong>Upload License</strong> (JPG, PNG, max 5MB)</span><input type="file" id="dl-image" class="file-upload-input" accept="image/jpeg,image/png" required></label> <div class="file-preview" id="dl-image-preview"></div> </div>
                <h3 class="section-title">Good Conduct Certificate</h3>
                <div class="form-row"> <div class="form-group"><label for="good-conduct-number" class="form-label required">Certificate Number</label><input type="text" id="good-conduct-number" class="form-control" placeholder="Enter certificate no." required></div> <div class="form-group"><label for="good-conduct-expiry" class="form-label required">Expiry Date</label><input type="date" id="good-conduct-expiry" class="form-control" required></div> </div>
                <div class="form-group"> <label class="form-label required">Certificate Image</label> <label class="file-upload" for="good-conduct-image"><span class="file-upload-icon">📄</span> <span class="file-upload-text"><strong>Upload Certificate</strong> (JPG, PNG, PDF, max 5MB)</span><input type="file" id="good-conduct-image" class="file-upload-input" accept="image/jpeg,image/png,application/pdf" required></label> <div class="file-preview" id="good-conduct-image-preview"></div> </div>
                <h3 class="section-title">Insurance Information</h3>
                <div class="form-row"> <div class="form-group"><label for="insurance-number" class="form-label required">Policy Number</label><input type="text" id="insurance-number" class="form-control" placeholder="Enter policy no." required></div> <div class="form-group"><label for="insurance-expiry" class="form-label required">Expiry Date</label><input type="date" id="insurance-expiry" class="form-control" required></div> </div>
                <div class="form-group"> <label class="form-label required">Insurance Certificate Image</label> <label class="file-upload" for="insurance-image"><span class="file-upload-icon">🛡️</span> <span class="file-upload-text"><strong>Upload Insurance</strong> (JPG, PNG, PDF, max 5MB)</span><input type="file" id="insurance-image" class="file-upload-input" accept="image/jpeg,image/png,application/pdf" required></label> <div class="file-preview" id="insurance-image-preview"></div> </div>
                <h3 class="section-title">Motorbike Details</h3>
                <div class="form-group"><label for="bike-numberplate" class="form-label required">Number Plate</label><input type="text" id="bike-numberplate" class="form-control" placeholder="e.g., KMC A123B" required></div>
                <div class="form-group"> <label class="form-label required">Motorbike Image</label> <label class="file-upload" for="bike-image"><span class="file-upload-icon">🏍️</span> <span class="file-upload-text"><strong>Upload Bike Photo</strong> (JPG, PNG, max 5MB)</span><input type="file" id="bike-image" class="file-upload-input" accept="image/jpeg,image/png" required></label> <div class="file-preview" id="bike-image-preview"></div> </div>
                <div class="form-row"> <div class="form-group"><label for="residence-area" class="form-label required">Area of Residence</label><input type="text" id="residence-area" class="form-control" placeholder="e.g., Kilimani, Nairobi" required></div> <div class="form-group"><label for="work-area" class="form-label required">Primary Work Area</label><input type="text" id="work-area" class="form-control" placeholder="e.g., Westlands" required></div> </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" id="step2-documents-back">Back</button>
                    <button type="button" class="btn btn-primary" id="step2-documents-next">Continue</button>
                </div>
            </form>

            <form id="step3-profile-form" class="form-step">
                 <h3 class="section-title">Next of Kin</h3>
                <div class="form-group"><label for="kin-name" class="form-label required">Full Name</label><input type="text" id="kin-name" class="form-control" placeholder="Full name" required></div>
                <div class="form-row"> <div class="form-group"><label for="kin-id" class="form-label required">ID Number</label><input type="text" id="kin-id" class="form-control" placeholder="ID number" required></div> <div class="form-group"><label for="kin-contact" class="form-label required">Contact Number</label><input type="tel" id="kin-contact" class="form-control" placeholder="Phone number" required></div> </div>
                <div class="form-row"> <div class="form-group"><label for="kin-relationship" class="form-label required">Relationship</label><input type="text" id="kin-relationship" class="form-control" placeholder="e.g. Spouse, Parent" required></div> <div class="form-group"><label for="kin-residence" class="form-label required">Area of Residence</label><input type="text" id="kin-residence" class="form-control" placeholder="e.g., Kasarani" required></div> </div>
                <h3 class="section-title">Emergency Contact 1</h3>
                <div class="form-group"><label for="emergency1-name" class="form-label required">Full Name</label><input type="text" id="emergency1-name" class="form-control" placeholder="Full name" required></div>
                <div class="form-row"> <div class="form-group"><label for="emergency1-id" class="form-label">ID Number (Optional)</label><input type="text" id="emergency1-id" class="form-control" placeholder="ID number"></div> <div class="form-group"><label for="emergency1-contact" class="form-label required">Contact Number</label><input type="tel" id="emergency1-contact" class="form-control" placeholder="Phone number" required></div> </div>
                <div class="form-row"> <div class="form-group"><label for="emergency1-relationship" class="form-label">Relationship (Optional)</label><input type="text" id="emergency1-relationship" class="form-control" placeholder="e.g. Friend"></div> <div class="form-group"><label for="emergency1-residence" class="form-label">Area of Residence (Optional)</label><input type="text" id="emergency1-residence" class="form-control" placeholder="e.g., South B"></div> </div>
                <h3 class="section-title">Emergency Contact 2 (Optional)</h3>
                 <div class="form-group"><label for="emergency2-name" class="form-label">Full Name</label><input type="text" id="emergency2-name" class="form-control" placeholder="Full name"></div>
                <div class="form-row"> <div class="form-group"><label for="emergency2-id" class="form-label">ID Number</label><input type="text" id="emergency2-id" class="form-control" placeholder="ID number"></div> <div class="form-group"><label for="emergency2-contact" class="form-label">Contact Number</label><input type="tel" id="emergency2-contact" class="form-control" placeholder="Phone number"></div> </div>
                <div class="form-row"> <div class="form-group"><label for="emergency2-relationship" class="form-label">Relationship</label><input type="text" id="emergency2-relationship" class="form-control" placeholder="e.g. Colleague"></div> <div class="form-group"><label for="emergency2-residence" class="form-label">Area of Residence</label><input type="text" id="emergency2-residence" class="form-control" placeholder="e.g., Ruiru"></div> </div>
                <h3 class="section-title">Profile Information</h3>
                <div class="form-group"><label for="username" class="form-label required">Username</label><input type="text" id="username" class="form-control" placeholder="Choose a unique username" required></div>
                <div class="form-group"><label for="bio" class="form-label">Bio (Optional)</label><textarea id="bio" class="form-control" rows="3" placeholder="Tell us a bit about yourself and your experience (max 150 characters)"></textarea></div>
                <div class="form-group"> <div class="alert alert-info"> <span class="alert-icon">🛡️</span> <span>By submitting, you agree to RiderConnect's <a href="/terms" target="_blank" style="color: var(--info-text); text-decoration: underline;">Terms of Service</a> and <a href="/privacy" target="_blank" style="color: var(--info-text); text-decoration: underline;">Privacy Policy</a>.</span> </div> </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" id="step3-profile-back">Back</button>
                    <button type="submit" class="btn btn-primary" id="step3-profile-submit">Complete Registration</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const stepForms = [
            document.getElementById('step1-contact-secure-form'),
            document.getElementById('step2-documents-form'),
            document.getElementById('step3-profile-form')
        ];
        const progressSteps = [
            document.getElementById('step1-indicator'),
            document.getElementById('step2-indicator'),
            document.getElementById('step3-indicator')
        ];
        const globalAlertPlaceholder = document.getElementById('global-alert-placeholder');

        // Sections within Step 1
        const contactInputSection = document.getElementById('contact-input-section');
        const otpVerificationSection = document.getElementById('otp-verification-section');
        const passwordSetupSection = document.getElementById('password-setup-section');

        // Master button for Step 1
        const step1MasterNextBtn = document.getElementById('step1-master-next');
        
        // Navigation buttons for other steps
        const step2DocumentsBackBtn = document.getElementById('step2-documents-back');
        const step2DocumentsNextBtn = document.getElementById('step2-documents-next');
        const step3ProfileBackBtn = document.getElementById('step3-profile-back');
        const step3ProfileSubmitBtn = document.getElementById('step3-profile-submit'); // Corrected ID

        // OTP elements within Step 1's OTP section
        const emailOtpGroup = document.getElementById('email-otp-group');
        const phoneOtpGroup = document.getElementById('phone-otp-group');
        const resendEmailOtpBtn = document.getElementById('resend-email-otp');
        const resendPhoneOtpBtn = document.getElementById('resend-phone-otp');

        const registrationData = {};
        let currentStep = 0; // 0-indexed for stepForms array
        let step1Phase = 'contact'; // 'contact', 'otp', 'password'
        let emailOtpVerified = false;
        let phoneOtpVerified = false;

        // Password Toggles
        document.querySelectorAll('.password-toggle-icon').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const targetId = this.dataset.target;
                const passwordInput = document.getElementById(targetId);
                if (passwordInput) {
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        this.textContent = '🙈'; // Or use a different emoji/icon
                    } else {
                        passwordInput.type = 'password';
                        this.textContent = '👁️';
                    }
                }
            });
        });


        function showAlert(message, type = 'info', duration = 7000) { /* ... same ... */ }
        function getIconForType(type) { /* ... same ... */ }
        function clearAllAlerts() { globalAlertPlaceholder.innerHTML = ''; }
        function formatFileSize(bytes) { /* ... same ... */ }
        const fileUploadMetas = [ /* ... same ... */ ];
        fileUploadMetas.forEach(meta => { /* ... same file upload setup ... */ });
            
        function setupOTPInputs(containerSelector) { /* ... same, ensure data-otp-group and data-index are used ... */
            const inputs = document.querySelectorAll(`${containerSelector} .otp-input`);
            inputs.forEach((input, idx) => {
                input.addEventListener('input', (e) => {
                    const value = e.target.value.replace(/[^0-9]/g, '');
                    e.target.value = value;
                    if (value.length === 1 && idx < inputs.length - 1) {
                        inputs[idx + 1].focus();
                    }
                });
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && input.value.length === 0 && idx > 0) {
                        inputs[idx - 1].focus();
                    }
                });
                 input.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const pasteData = (e.clipboardData || window.clipboardData).getData('text').replace(/[^0-9]/g, '');
                    if (!pasteData) return;
                    
                    let currentPastedIndex = 0;
                    const currentInputGroup = input.dataset.otpGroup; // email or phone
                    const groupInputs = document.querySelectorAll(`#${currentInputGroup}-otp-group .otp-input`);

                    for (let i = parseInt(input.dataset.index); i < groupInputs.length && currentPastedIndex < pasteData.length; i++) {
                        groupInputs[i].value = pasteData[currentPastedIndex++];
                        if (i < groupInputs.length - 1 && currentPastedIndex < pasteData.length) {
                             groupInputs[i+1].focus();
                        } else {
                            groupInputs[i].focus();
                        }
                    }
                });
            });
        }
            
        setupOTPInputs('#email-otp-group');
        setupOTPInputs('#phone-otp-group');
            
        function goToStep(stepIndex) {
            clearAllAlerts();
            stepForms.forEach((form, index) => form.classList.toggle('active', index === stepIndex));
            progressSteps.forEach((indicator, index) => {
                indicator.classList.remove('active', 'completed');
                if (index < stepIndex) indicator.classList.add('completed');
                else if (index === stepIndex) indicator.classList.add('active');
            });
            currentStep = stepIndex;
            window.scrollTo(0,0);
        }

        function updateStep1ButtonText() {
            if (step1Phase === 'contact') step1MasterNextBtn.textContent = 'Continue';
            else if (step1Phase === 'otp') step1MasterNextBtn.textContent = 'Verify OTPs';
            else if (step1Phase === 'password') step1MasterNextBtn.textContent = 'Set Password & Continue';
        }

        function validateStep1Contacts() { /* ... same ... */ return true; } // Assume true for now
        
        function clearOtpInputs(containerSelector) { /* ... same ... */ }
        function enableOtpInputs(containerSelector, enable = true) { /* ... same ... */ }

        async function handleOtpSubmissionForStep1(otpGroupElement, otpType, expectedOtp = "123456") {
            const otpInputs = otpGroupElement.querySelectorAll('.otp-input');
            const otpValue = Array.from(otpInputs).map(input => input.value).join('');

            if (otpValue.length !== 6) {
                showAlert(`Please enter the complete 6-digit ${otpType} OTP.`, 'error');
                return false;
            }
            showAlert(`Verifying ${otpType} OTP...`, 'info', 0);
            step1MasterNextBtn.classList.add('btn-loading'); step1MasterNextBtn.disabled = true;
            await new Promise(resolve => setTimeout(resolve, 1000));

            if (otpValue === expectedOtp) {
                showAlert(`${otpType} OTP verified!`, 'success');
                if (otpType === 'Email') emailOtpVerified = true;
                if (otpType === 'Phone') phoneOtpVerified = true;
                enableOtpInputs(otpGroupElement.id === 'email-otp-group' ? '#email-otp-group' : '#phone-otp-group', false);
                step1MasterNextBtn.classList.remove('btn-loading'); step1MasterNextBtn.disabled = false;
                return true;
            } else {
                showAlert(`Invalid ${otpType} OTP. Please try again.`, 'error');
                clearOtpInputs(otpGroupElement.id === 'email-otp-group' ? '#email-otp-group' : '#phone-otp-group');
                otpInputs[0].focus();
                step1MasterNextBtn.classList.remove('btn-loading'); step1MasterNextBtn.disabled = false;
                return false;
            }
        }

        function validatePasswordStep1() { /* ... same as validatePasswordStep, using IDs password & confirm-password ... */
            clearAllAlerts();
            const passwordEl = document.getElementById('password');
            const confirmPasswordEl = document.getElementById('confirm-password');
            const password = passwordEl.value;
            const confirmPassword = confirmPasswordEl.value;
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]).{8,}$/;

            if (!passwordRegex.test(password)) {
                showAlert('Password: Min. 8 chars, with uppercase, lowercase, number, and symbol.', 'error', 10000);
                passwordEl.focus(); return false;
            }
            if (password !== confirmPassword) {
                showAlert('Passwords do not match.', 'error');
                confirmPasswordEl.focus(); return false;
            }
            registrationData.password = password;
            return true;
         }

        if (step1MasterNextBtn) {
            step1MasterNextBtn.addEventListener('click', async function() {
                clearAllAlerts();
                if (step1Phase === 'contact') {
                    if (!validateStep1Contacts()) return;
                    registrationData.email = document.getElementById('email').value.trim();
                    registrationData.phone = document.getElementById('phone').value.trim().replace(/\s/g, '');

                    // Simulate sending OTPs
                    sendOtp('Email', emailOtpGroup);
                    sendOtp('Phone', phoneOtpGroup);
                    
                    // Show OTP and Password sections, hide contact inputs
                    contactInputSection.classList.add('hidden-section');
                    otpVerificationSection.classList.remove('hidden-section');
                    passwordSetupSection.classList.remove('hidden-section'); // Show password fields along with OTP
                    
                    emailOtpVerified = false; phoneOtpVerified = false; // Reset for new verification
                    clearOtpInputs('#email-otp-group'); clearOtpInputs('#phone-otp-group');
                    enableOtpInputs('#email-otp-group', true); enableOtpInputs('#phone-otp-group', true);
                    document.getElementById('password').value = ''; document.getElementById('confirm-password').value = '';


                    step1Phase = 'otp'; // Or directly 'otp_and_password' since they are shown together
                    updateStep1ButtonText();
                    document.querySelector('#email-otp-group .otp-input').focus();

                } else if (step1Phase === 'otp') { // This phase will now handle both OTP and Password
                    let currentEmailOtpVerified = emailOtpVerified;
                    let currentPhoneOtpVerified = phoneOtpVerified;

                    if (!currentEmailOtpVerified) {
                        if (!await handleOtpSubmissionForStep1(emailOtpGroup, 'Email')) return;
                        currentEmailOtpVerified = emailOtpVerified;
                    }
                    if (!currentPhoneOtpVerified) {
                        if (!await handleOtpSubmissionForStep1(phoneOtpGroup, 'Phone')) return;
                        currentPhoneOtpVerified = phoneOtpVerified;
                    }

                    if (currentEmailOtpVerified && currentPhoneOtpVerified) {
                        if (validatePasswordStep1()) {
                            showAlert('Contact verified and password set successfully!', 'success');
                            // All of Step 1 is complete, move to next main step
                            goToStep(1); // Go to Step 2: Documents
                        }
                    } else {
                        if (!currentEmailOtpVerified) showAlert('Please verify your Email OTP.', 'error');
                        else if (!currentPhoneOtpVerified) showAlert('Please verify your Phone OTP.', 'error');
                    }
                }
                // No separate 'password' phase for the button click, it's handled above
            });
        }
        
        function sendOtp(type, otpGroupElement) { /* ... same, ensure it focuses correctly if element provided ... */ }

        if(resendEmailOtpBtn) resendEmailOtpBtn.addEventListener('click', () => { /* ... same, ensure targets are correct ... */ });
        if(resendPhoneOtpBtn) resendPhoneOtpBtn.addEventListener('click', () => { /* ... same ... */ });

        function validateStep2Documents() { /* Renamed, content same as validateStepDocuments */ return true; }
        if(step2DocumentsBackBtn) step2DocumentsBackBtn.addEventListener('click', () => {
            // When going back from Documents, reset Step 1 to contact input phase
            contactInputSection.classList.remove('hidden-section');
            otpVerificationSection.classList.add('hidden-section');
            passwordSetupSection.classList.add('hidden-section');
            step1Phase = 'contact';
            updateStep1ButtonText();
            goToStep(0);
        });
        if(step2DocumentsNextBtn) step2DocumentsNextBtn.addEventListener('click', () => { if (validateStep2Documents()) goToStep(2); });

        function validateStep3Profile() { /* Renamed, content same as validateStepProfile */ return true; }
        if(step3ProfileBackBtn) step3ProfileBackBtn.addEventListener('click', () => goToStep(1));
        
        if(stepForms[2]) { // Corresponds to step3-profile-form
            stepForms[2].addEventListener('submit', function(e) { /* ... same submit logic as step4ProfileSubmitBtn ... */ });
        }
        
        updateStep1ButtonText(); // Initial button text
        goToStep(0);
    });
    const fileUploadMetas = [ /* ... same fileUploadMetas definition ... */ ];
    </script>
</body>
</html>